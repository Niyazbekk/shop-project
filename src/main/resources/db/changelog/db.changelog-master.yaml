databaseChangeLog:
  - logicalFilePath: db/changelog/db.changelog-master.yaml
  - changeSet:
      id: 1
      author: postgres
      changes:
        - createTable:
            tableName: _user
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: username
                  type: varchar(255)
                  constraints:
                    unique: true
                    nullable: false
              - column:
                  name: password
                  type: varchar(255)
                  constraints:
                    nullable: false

  - changeSet:
      id: 2
      author: postgres
      changes:
        - createTable:
            tableName: product_category
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false

  - changeSet:
      id: 3
      author: postgres
      changes:
        - createTable:
            tableName: product
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: varchar(255)
                  constraints:
                    nullable: false
              - column:
                  name: cost
                  type: DOUBLE PRECISION
              - column:
                  name: product_category_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: FK_PRODUCT_ON_PRODUCTCATEGORYID
                    references: product_category (id)
                    deleteCascade: true
                    nullable: false

  - changeSet:
      id: 4
      author: postgres
      changes:
        - createTable:
            tableName: basket
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: FK_BASKET_ON_USERID
                    references: _user(id)
                    deleteCascade: true
                    nullable: false
              - column:
                  name: product_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: FK_BASKET_ON_PRODUCTID
                    references: product (id)
                    deleteCascade: true
                    nullable: false

  - changeSet:
      id: 5
      author: postgres
      changes:
        - createTable:
            tableName: role
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: varchar(255)
                  constraints:
                    nullable: false

  - changeSet:
      id: 6
      author: postgres
      changes:
        - createTable:
            tableName: _user_roles
            columns:
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: fk_userol_on_user
                    references: _user(id)
                    deleteCascade: true
                    nullable: false
              - column:
                  name: roles_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: fk_userol_on_role
                    references: role(id)
                    deleteCascade: true
                    nullable: false

  - changeSet:
      id: 7
      author: postgres
      changes:
        - createTable:
            tableName: rate
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: FK_RATE_ON_USERID
                    references: _user(id)
                    deleteCascade: true
                    nullable: false
              - column:
                  name: product_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: FK_RATE_ON_PRODUCTID
                    references: product (id)
                    deleteCascade: true
                    nullable: false
              - column:
                  name: rating
                  type: DOUBLE PRECISION
                  constraints:
                    nullable: false
  - changeSet:
      id: 8
      author: postgres
      changes:
        - createTable:
            tableName: comment
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: FK_COMMENT_ON_USERID
                    references: _user(id)
                    deleteCascade: true
                    nullable: false
              - column:
                  name: product_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: FK_COMMENT_ON_PRODUCTID
                    references: product (id)
                    deleteCascade: true
                    nullable: false
              - column:
                  name: content
                  type: VARCHAR(255)
                  constraints:
                    nullable: false

  - include:
      - file: db/changelog/db.changelog-insert.yaml